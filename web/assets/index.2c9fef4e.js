import{F as e,Q as t,M as s,l as n,f as l,a as o,b as a,c as i,d as r,e as d,g as c,h as p,i as m,j as b,k as h,m as u,n as w,o as g,p as v,q as f,r as y,s as k,w as C,t as P,u as x,v as I,x as q,y as A,z as S,A as B,B as O}from"./vendor.a1d4a7f9.js";const U={components:{FontAwesomeIcon:e},data:e=>({ws:null,server:{gateway:"",publicKey:"",endpoint:"",network:"",possibleIPs:[]},peers:[],onepeer:{id:-1,ip:"",name:""},qrUrl:""}),methods:{getConfig(e){let t="";return this.peers.hasOwnProperty(e)&&(t="[Interface]\n",t+=`PrivateKey = ${this.peers[e].keys.private}\n`,t+=`Address = ${this.peers[e].ip}/32\n`,t+=`DNS = ${this.server.gateway}\n\n`,t+="[Peer]\n",t+=`PublicKey = ${this.server.publicKey}\n`,t+=`AllowedIPs = ${this.server.network}\n`,t+=`Endpoint = ${this.server.endpoint}\n`,t+="PersistentKeepalive = 25"),t},toggleAdmin(e){this.peers.hasOwnProperty(e)&&(this.onepeer.id=e,this.wsSend({cmd:"peers",action:"admin",index:this.onepeer.id}),this.onepeer.id=-1)},fileConfig(e){if(this.peers.hasOwnProperty(e)){let t=this.getConfig(e),s=document.createElement("a");s.download="wired.conf";let n=new Blob([t],{type:"text/plain"});s.href=URL.createObjectURL(n),s.click(),URL.revokeObjectURL(s.href)}},qrConfig(e){if(this.peers.hasOwnProperty(e)){let n=this.getConfig(e),l=new t({value:n,size:500,level:"H"});this.qrUrl=l.toDataURL("image/jpeg"),new s(document.getElementById("qrpeer_modal")).show()}},preNewPeer(){new s(document.getElementById("newpeer_modal")).show()},preDelPeer(e){this.peers.hasOwnProperty(e)&&(this.onepeer.id=e,new s(document.getElementById("delpeer_modal")).show())},newPeer(){this.wsSend({cmd:"peers",action:"add",ip:this.onepeer.ip,name:this.onepeer.name}),this.onepeer={id:-1,ip:"",name:""},s.getInstance(document.getElementById("newpeer_modal")).hide()},delPeer(){this.wsSend({cmd:"peers",action:"del",index:this.onepeer.id}),this.onepeer.id=-1,s.getInstance(document.getElementById("delpeer_modal")).hide()},reloadConfig(){this.wsSend({cmd:"peers",action:"all"})},wsSend(e){let t=!1;try{this.ws.send(JSON.stringify(e)),t=!0}catch(s){}return t},wsMessages(e){let t=JSON.parse(e.data);if(t&&t.ok)switch(t.cmd){case"peers":switch(t.action){case"all":this.peers=t.peers,this.server=t.server;break;case"add":t.hasOwnProperty("possible_ips")&&(this.server.possibleIPs=t.possible_ips)}}},wsAlert(e){let t=document.createElement("div");t.setAttribute("class","alert alert-warning alert-dismissible my-3 fade show"),t.setAttribute("role","alert"),t.innerHTML=e+'<button type="button" data-bs-dismiss="alert" class="btn-close"></button>',document.querySelector("#app").prepend(t)},shortBytes(e){let t=0,s=e;for(;s>=1024;t++)s/=1024;return s.toFixed(1)+" "+["байт","Кб","Мб","Гб","Пб"][t]}},created(){n.add(l,o,a,i,r,d,c,p,m,b,h,u,w,g,v),this.ws=new WebSocket("ws://"+location.hostname+":3001"),this.ws.addEventListener("message",this.wsMessages),this.wsSend({cmd:"peers",action:"all"})}},_={class:"container-md mt-2"},E={class:"row g-2"},L={class:"col-12"},F={class:"d-flex align-items-center"},R=k("h1",{class:"flex-fill mb-0"},"wired",-1),N={key:0,class:"col-12"},$=k("span",{class:"text-muted"},"Нет ни одного пира. Добавьте нового, нажав на синюю кнопку выше!",-1),j={class:"col-12"},D={class:"d-flex align-items-center"},K={class:"flex-fill mb-0"},M={class:"col-auto btn-group d-none d-md-block"},Q={type:"button",class:"btn btn-outline-light",disabled:""},z={class:"text-black-50 lh-1 me-1"},H={class:"col-auto d-inline-block d-md-none"},J={class:"dropdown"},V={type:"button",class:"btn btn-light text-black-50 w-100","data-bs-toggle":"dropdown",title:"Действия с пользователем"},T={class:"dropdown-menu"},W={class:"small text-muted lh-1"},G={class:"me-1"},X={key:0,class:"me-1"},Y={key:1,class:"me-1"},Z={key:2},ee={class:"col-12"},te={class:"modal fade",id:"newpeer_modal"},se={class:"modal-dialog"},ne={class:"modal-content rounded-6 shadow border-0 py-2"},le={class:"modal-body"},oe={class:"mb-3"},ae=k("label",{class:"form-label",for:"nameField"},"Имя",-1),ie={class:"mb-3"},re=k("label",{class:"form-label",for:"ipField"},"IP",-1),de={id:"ipList"},ce={key:0,class:"form-text"},pe={class:"modal-footer border-top-0"},me=k("button",{type:"button",class:"btn btn-lg w-100 btn-light","data-bs-dismiss":"modal"},"Закрыть",-1),be={class:"modal fade",id:"delpeer_modal"},he={class:"modal-dialog"},ue={class:"modal-content rounded-6 shadow border-0 py-2"},we=k("div",{class:"modal-body"},[k("p",null,"Подтвердите удаление нажатием на кнопку «Удалить» ниже")],-1),ge={class:"modal-footer border-top-0"},ve=k("button",{type:"button",class:"btn btn-lg w-100 btn-light","data-bs-dismiss":"modal"},"Закрыть",-1),fe={class:"modal fade",id:"qrpeer_modal"},ye={class:"modal-dialog"},ke={class:"modal-content rounded-6 shadow border-0 py-2"},Ce={class:"modal-body"},Pe=k("div",{class:"modal-footer border-top-0"},[k("button",{type:"button",class:"btn btn-lg w-100 btn-light","data-bs-dismiss":"modal"},"Закрыть")],-1);U.render=function(e,t,s,n,l,o){const a=B("FontAwesomeIcon");return f(),y("div",_,[k("div",E,[k("div",L,[k("div",F,[R,k("button",{type:"button",class:"btn btn-primary",onClick:t[1]||(t[1]=C(((...e)=>o.preNewPeer&&o.preNewPeer(...e)),["prevent"]))},[k(a,{icon:"user-plus"})]),k("button",{type:"button",class:"btn btn-light text-black-50",onClick:t[2]||(t[2]=C(((...e)=>o.reloadConfig&&o.reloadConfig(...e)),["prevent"]))},[k(a,{icon:"arrows-rotate"})])])]),e.peers.length<1?(f(),y("div",N,[$])):(f(!0),y(P,{key:1},x(e.peers,((e,t)=>(f(),y("div",j,[k("div",D,[k("h3",K,A(e.name),1),k("div",M,[k("button",Q,[k("span",z,A(e.online?"Онлайн":"Не в сети"),1),void 0!==e.online?(f(),y(a,{key:0,icon:e.online?"face-smile":"face-frown",class:"text-"+(e.online?"success":"warning")},null,8,["icon","class"])):S("",!0)]),k("button",{type:"button",class:"btn btn-light text-black-50",onClick:C((e=>o.toggleAdmin(t)),["prevent"]),title:e.admin?"Исключить из администраторов":"Сделать администратором"},[k(a,{icon:e.admin?"unlock":"lock"},null,8,["icon"])],8,["onClick","title"]),k("button",{type:"button",class:"btn btn-light text-black-50",onClick:C((e=>o.fileConfig(t)),["prevent"]),title:"Скачать конфигурацию wired.conf"},[k(a,{icon:"download"})],8,["onClick"]),k("button",{type:"button",class:"btn btn-light text-black-50",onClick:C((e=>o.qrConfig(t)),["prevent"]),title:"QR-код конфигурации для смартфона"},[k(a,{icon:"qrcode"})],8,["onClick"]),k("button",{type:"button",class:"btn btn-light",onClick:C((e=>o.preDelPeer(t)),["prevent"]),title:"Удалить пира"},[k(a,{icon:"times",class:"text-danger"})],8,["onClick"])]),k("div",H,[k("div",J,[k("button",V,[k(a,{icon:"bars"})]),k("div",T,[k("a",{href:"#",class:"dropdown-item",onClick:C((e=>o.toggleAdmin(t)),["prevent"])},A(e.admin?"-Адм":"+Адм"),9,["onClick"]),k("a",{href:"#",class:"dropdown-item",onClick:C((e=>o.fileConfig(t)),["prevent"])},"Конфигурация",8,["onClick"]),k("a",{href:"#",class:"dropdown-item",onClick:C((e=>o.qrConfig(t)),["prevent"])},"QR-код",8,["onClick"]),k("a",{href:"#",class:"dropdown-item text-danger",onClick:C((e=>o.preDelPeer(t)),["prevent"])},"Удалить",8,["onClick"])])])])]),k("div",W,[k("span",G,A(e.ip),1),e.foreignpair?(f(),y("span",X,"("+A(e.foreignpair)+")",1)):S("",!0),e.tx?(f(),y("span",Y,[k(a,{icon:"chevron-down",class:"me-1"}),k("span",null,A(o.shortBytes(e.tx)),1)])):S("",!0),e.rx?(f(),y("span",Z,[k(a,{icon:"chevron-up",class:"me-1"}),k("span",null,A(o.shortBytes(e.rx)),1)])):S("",!0)])])))),256)),k("div",ee,[k("div",te,[k("div",se,[k("div",ne,[k("div",le,[k("form",null,[k("div",oe,[ae,I(k("input",{type:"text",class:"form-control",id:"nameField","onUpdate:modelValue":t[3]||(t[3]=t=>e.onepeer.name=t)},null,512),[[q,e.onepeer.name]])]),k("div",ie,[re,I(k("input",{type:"text",class:"form-control",id:"ipField",list:"ipList","onUpdate:modelValue":t[4]||(t[4]=t=>e.onepeer.ip=t)},null,512),[[q,e.onepeer.ip]]),k("datalist",de,[(f(!0),y(P,null,x(e.server.possibleIPs,(e=>(f(),y("option",null,A(e),1)))),256))]),e.server.network&&e.server.network.length>1?(f(),y("small",ce,"Выбирайте доступный IP-адрес из сети "+A(e.server.network),1)):S("",!0)])])]),k("div",pe,[k("button",{type:"button",class:"btn btn-lg w-100 btn-primary",onClick:t[5]||(t[5]=C(((...e)=>o.newPeer&&o.newPeer(...e)),["prevent"]))},"Добавить"),me])])])]),k("div",be,[k("div",he,[k("div",ue,[we,k("div",ge,[k("button",{type:"button",class:"btn btn-lg w-100 btn-danger",onClick:t[6]||(t[6]=C(((...e)=>o.delPeer&&o.delPeer(...e)),["prevent"]))},"Удалить"),ve])])])]),k("div",fe,[k("div",ye,[k("div",ke,[k("div",Ce,[k("img",{src:e.qrUrl,class:"img-fluid",alt:"QR-код конфигурации"},null,8,["src"])]),Pe])])])])])])},O(U).mount("#wired");
